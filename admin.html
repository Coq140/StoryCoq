<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel | InstaClone</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #333; color: white; }
    button { padding: 5px 10px; margin: 0 3px; }
    .badge {
      font-size: 18px;
      margin-right: 5px;
    }
    .logo {
      width: 30px;
      height: 30px;
      vertical-align: middle;
      border-radius: 3px;
      margin-right: 5px;
    }
  </style>
</head>
<body>

<h1>Panel Admin</h1>

<table id="usersTable">
  <thead>
    <tr>
      <th>Utilisateur</th>
      <th>Badges</th>
      <th>Affili√© √†</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="logout()">D√©connexion</button>

<script>
const entreprises = {
  'AcmeCorp': { name: "Acme Corporation", logo: "logos/acmecorp.png" },
  'TechInc': { name: "Tech Incorporated", logo: "logos/techinc.png" },
};

// Injecte des utilisateurs d'exemple si localStorage est vide
if(!localStorage.getItem('instaUsers')){
  const sampleUsers = [
    { name: "Alice", badges: ["admin"], affiliateWith: "AcmeCorp" },
    { name: "Bob", badges: ["vip"], affiliateWith: "TechInc" },
    { name: "Charlie", badges: [] }
  ];
  localStorage.setItem('instaUsers', JSON.stringify(sampleUsers));
}

let users = JSON.parse(localStorage.getItem('instaUsers'));

// Injecte un utilisateur admin connect√© si aucun instaUser
if(!localStorage.getItem('instaUser')){
  localStorage.setItem('instaUser', JSON.stringify({ name: "Alice", badges: ["admin"] }));
}

const currentUser = JSON.parse(localStorage.getItem('instaUser'));

// V√©rification admin
if(!currentUser || !currentUser.badges || !currentUser.badges.includes('admin')){
  alert("Acc√®s refus√© : vous devez √™tre admin.");
  window.location.href = "index.html";
}

function renderUsers(){
  console.log("Rendering users:", users);
  const tbody = document.querySelector('#usersTable tbody');
  tbody.innerHTML = '';

  if(users.length === 0){
    const tr = document.createElement('tr');
    const td = document.createElement('td');
    td.colSpan = 4;
    td.style.textAlign = 'center';
    td.textContent = 'Aucun utilisateur trouv√©.';
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }

  users.forEach((user) => {
    const tr = document.createElement('tr');

    // Nom
    const tdName = document.createElement('td');
    tdName.textContent = user.name;
    tr.appendChild(tdName);

    // Badges
    const tdBadges = document.createElement('td');
    if(user.badges){
      user.badges.forEach(badge => {
        const span = document.createElement('span');
        span.className = 'badge';
        if(badge === 'admin') span.textContent = 'üõ°Ô∏è';
        else if(badge === 'staff') span.textContent = '‚≠ê';
        else if(badge === 'vip') span.textContent = 'üíé';
        else span.textContent = badge;
        tdBadges.appendChild(span);
      });
    }
    tr.appendChild(tdBadges);

    // Affili√© √†
    const tdAffiliate = document.createElement('td');
    if(user.affiliateWith && entreprises[user.affiliateWith]){
      const img = document.createElement('img');
      img.src = entreprises[user.affiliateWith].logo;
      img.alt = entreprises[user.affiliateWith].name;
      img.title = entreprises[user.affiliateWith].name;
      img.className = 'logo';
      tdAffiliate.appendChild(img);
      tdAffiliate.appendChild(document.createTextNode(entreprises[user.affiliateWith].name));
    } else {
      tdAffiliate.textContent = '‚Äî';
    }
    tr.appendChild(tdAffiliate);

    // Actions
    const tdActions = document.createElement('td');

    // S√©lecteur d‚Äôaffiliation
    const select = document.createElement('select');

    const optionNone = document.createElement('option');
    optionNone.value = '';
    optionNone.textContent = 'Aucune';
    select.appendChild(optionNone);

    Object.keys(entreprises).forEach(key => {
      const option = document.createElement('option');
      option.value = key;
      option.textContent = entreprises[key].name;
      if(user.affiliateWith === key) option.selected = true;
      select.appendChild(option);
    });
    tdActions.appendChild(select);

    // Bouton sauvegarder
    const saveBtn = document.createElement('button');
    saveBtn.textContent = 'Sauvegarder';
    saveBtn.onclick = () => {
      user.affiliateWith = select.value || null;
      saveUsers();
      renderUsers();
      alert(`Affiliation mise √† jour pour ${user.name}`);
    };
    tdActions.appendChild(saveBtn);

    tr.appendChild(tdActions);

    tbody.appendChild(tr);
  });
}

function saveUsers(){
  localStorage.setItem('instaUsers', JSON.stringify(users));
}

function logout(){
  localStorage.removeItem('instaUser');
  window.location.href = "index.html";
}

// Affiche la liste au chargement
renderUsers();

</script>

</body>
</html>
