<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Panel Admin | InstaClone</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
  h1 { margin-bottom: 20px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
  th { background: #eee; }
  input[type=text], select { width: 100%; padding: 5px; }
  button { padding: 5px 10px; margin: 2px; cursor: pointer; border: none; border-radius: 4px; }
  .btn-save { background: #28a745; color: white; }
  .btn-delete { background: #dc3545; color: white; }
  .btn-logout { background: #007bff; color: white; margin-bottom: 20px; }
</style>
</head>
<body>

<h1>Panel Admin</h1>
<button class="btn-logout" onclick="logout()">D√©connexion</button>

<table>
  <thead>
    <tr>
      <th>Nom d'utilisateur</th>
      <th>R√¥le</th>
      <th>Affiliation</th>
      <th>Certifi√©</th>
      <th>Mot de passe</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="usersTableBody"></tbody>
</table>

<script>
// R√©cup√©rer l'admin actuel (pour v√©rifier acc√®s)
const currentUser = JSON.parse(localStorage.getItem('instaUser'));
if(!currentUser || currentUser.badge !== 'admin'){
  alert("Acc√®s refus√©. Vous devez √™tre admin.");
  window.location.href = "index.html";
}

// R√©cup√©rer la liste des utilisateurs
let users = JSON.parse(localStorage.getItem('instaUsers')) || [];

// Fonction pour afficher la table des utilisateurs
function displayUsers(){
  const tbody = document.getElementById('usersTableBody');
  tbody.innerHTML = '';

  users.forEach((user, index) => {
    // Cr√©er une ligne par utilisateur
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td><input type="text" value="${user.name}" onchange="updateUser(${index}, 'name', this.value)"></td>
      <td>
        <select onchange="updateUser(${index}, 'badge', this.value)">
          <option value="" ${user.badge === '' ? 'selected' : ''}>User</option>
          <option value="admin" ${user.badge === 'admin' ? 'selected' : ''}>Admin</option>
          <option value="entreprise" ${user.badge === 'entreprise' ? 'selected' : ''}>Entreprise</option>
        </select>
      </td>
      <td>
        <input type="text" value="${user.affiliation || ''}" onchange="updateUser(${index}, 'affiliation', this.value)">
      </td>
      <td>
        <input type="checkbox" ${user.certified ? 'checked' : ''} onchange="updateUser(${index}, 'certified', this.checked)">
      </td>
      <td>
        <input type="text" value="${user.password}" readonly style="width:100px;">
      </td>
      <td>
        <button class="btn-save" onclick="saveUsers()">üíæ Sauvegarder</button>
        <button class="btn-delete" onclick="deleteUser(${index})">üóëÔ∏è Supprimer</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Met √† jour un champ d‚Äôun utilisateur dans la liste users
function updateUser(index, field, value){
  if(field === 'certified'){
    users[index][field] = value; // checkbox true/false
  } else {
    users[index][field] = value.trim();
  }
}

// Supprime un utilisateur
function deleteUser(index){
  if(confirm(`Supprimer l'utilisateur "${users[index].name}" ?`)){
    users.splice(index,1);
    saveUsers();
    displayUsers();
  }
}

// Sauvegarder la liste dans localStorage
function saveUsers(){
  localStorage.setItem('instaUsers', JSON.stringify(users));
  alert("Modifications sauvegard√©es !");
}

// D√©connexion admin
function logout(){
  localStorage.removeItem('instaUser');
  window.location.href = "index.html";
}

// Initialisation affichage
displayUsers();
</script>

</body>
</html>
