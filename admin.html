<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Gestion utilisateurs avanc√©e</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 10px;}
    table {width: 100%; border-collapse: collapse; margin-top: 15px;}
    th, td {border: 1px solid #aaa; padding: 8px; text-align: left;}
    th {background-color: #ddd;}
    input[type="text"], select {width: 100%; padding: 5px; box-sizing: border-box;}
    button {margin-top: 10px; padding: 8px 12px; cursor: pointer; background: #0095f6; color: white; border: none; border-radius: 4px; font-weight: bold;}
    button.delete {background: #d9534f;}
    button.delete:hover {background: #c9302c;}
    nav a {margin-right: 10px; text-decoration: none; font-weight: bold; color: #333;}
    nav a:hover {text-decoration: underline;}
  </style>
</head>
<body>

<header>
  <h1>Admin - Gestion des utilisateurs</h1>
  <nav>
    <a href="feed.html">Feed</a>
    <a href="profil.html">Profil</a>
    <a href="index.html" onclick="logout()">D√©connexion</a>
  </nav>
</header>

<div id="message"></div>

<table id="usersTable">
  <thead>
    <tr>
      <th>Nom d'utilisateur</th>
      <th>Badge</th>
      <th>Entreprise affili√©e</th>
      <th>Bio</th>
      <th>Avatar URL</th>
      <th>Banni√®re URL</th>
      <th>Story</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <!-- Utilisateurs list√©s ici -->
  </tbody>
</table>

<script>
  // Liste compl√®te des badges possibles, modifie ici pour ajouter ou retirer
  const badges = ["", "certifie", "entreprise", "admin", "vip", "moderateur", "partner"];

  let users = JSON.parse(localStorage.getItem('instaUsers')) || {};
  let currentUser = JSON.parse(localStorage.getItem('instaUser'));

  function redirectToIndex() {
    alert("Acc√®s refus√© : page admin r√©serv√©e aux administrateurs.");
    window.location.href = "index.html";
  }

  // V√©rification que seul un admin peut acc√©der
  if (!currentUser || currentUser.badge !== "admin") {
    redirectToIndex();
  }

  function saveUsers() {
    localStorage.setItem('instaUsers', JSON.stringify(users));
  }

  function updateCurrentUserIfNeeded(username) {
    if (currentUser && currentUser.name === username) {
      currentUser = { name: username, ...users[username] };
      localStorage.setItem('instaUser', JSON.stringify(currentUser));
    }
  }

  function buildTable() {
    const tbody = document.querySelector('#usersTable tbody');
    tbody.innerHTML = '';

    for (const username in users) {
      const user = users[username];
      const tr = document.createElement('tr');

      // Nom
      const tdName = document.createElement('td');
      tdName.textContent = username;
      tr.appendChild(tdName);

      // Badge (select)
      const tdBadge = document.createElement('td');
      const selectBadge = document.createElement('select');
      badges.forEach(b => {
        const option = document.createElement('option');
        option.value = b;
        option.textContent = b === "" ? "(aucun)" : b.charAt(0).toUpperCase() + b.slice(1);
        if (user.badge === b) option.selected = true;
        selectBadge.appendChild(option);
      });
      tdBadge.appendChild(selectBadge);
      tr.appendChild(tdBadge);

      // Entreprise affili√©e (input activ√© seulement si badge = entreprise)
      const tdEntreprise = document.createElement('td');
      const inputEntreprise = document.createElement('input');
      inputEntreprise.type = 'text';
      inputEntreprise.placeholder = "Nom compte affili√©";
      inputEntreprise.value = user.entrepriseAffiliee || "";
      if (user.badge !== "entreprise") {
        inputEntreprise.disabled = true;
        inputEntreprise.style.backgroundColor = "#eee";
      }
      tdEntreprise.appendChild(inputEntreprise);
      tr.appendChild(tdEntreprise);

      // Bio
      const tdBio = document.createElement('td');
      const inputBio = document.createElement('input');
      inputBio.type = 'text';
      inputBio.value = user.bio || "";
      tdBio.appendChild(inputBio);
      tr.appendChild(tdBio);

      // Avatar URL
      const tdAvatar = document.createElement('td');
      const inputAvatar = document.createElement('input');
      inputAvatar.type = 'text';
      inputAvatar.value = user.avatar || "";
      tdAvatar.appendChild(inputAvatar);
      tr.appendChild(tdAvatar);

      // Banni√®re URL
      const tdBanner = document.createElement('td');
      const inputBanner = document.createElement('input');
      inputBanner.type = 'text';
      inputBanner.value = user.banner || "";
      tdBanner.appendChild(inputBanner);
      tr.appendChild(tdBanner);

      // Story
      const tdStory = document.createElement('td');
      const inputStory = document.createElement('input');
      inputStory.type = 'text';
      inputStory.value = user.story || "";
      tdStory.appendChild(inputStory);
      tr.appendChild(tdStory);

      // Actions
      const tdActions = document.createElement('td');

      // Bouton sauvegarder
      const btnSave = document.createElement('button');
      btnSave.textContent = "Sauvegarder";
      btnSave.onclick = () => {
        const badgeSelected = selectBadge.value;
        users[username].badge = badgeSelected;
        users[username].bio = inputBio.value.trim();
        users[username].avatar = inputAvatar.value.trim() || "default-avatar.png";
        users[username].banner = inputBanner.value.trim();
        users[username].story = inputStory.value.trim();

        // Gestion entreprise affili√©e
        if (badgeSelected === "entreprise") {
          const affili√© = inputEntreprise.value.trim();
          if (affili√© && users[affili√©]) {
            users[username].entrepriseAffiliee = affili√©;
          } else if (affili√©) {
            alert("Le compte affili√© n'existe pas. Laissez vide ou mettez un compte valide.");
            users[username].entrepriseAffiliee = "";
            inputEntreprise.value = "";
          } else {
            users[username].entrepriseAffiliee = "";
          }
        } else {
          users[username].entrepriseAffiliee = "";
          inputEntreprise.value = "";
        }

        saveUsers();
        updateCurrentUserIfNeeded(username);
        alert(`Utilisateur "${username}" mis √† jour !`);
        buildTable();
      };
      tdActions.appendChild(btnSave);

      // Bouton supprimer (si ce n‚Äôest pas soi-m√™me)
      if (currentUser.badge === "admin" && username !== currentUser.name) {
        const btnDelete = document.createElement('button');
        btnDelete.textContent = "Supprimer";
        btnDelete.className = "delete";
        btnDelete.style.marginLeft = "8px";
        btnDelete.onclick = () => {
          if (confirm(`Supprimer l'utilisateur "${username}" ?`)) {
            delete users[username];
            saveUsers();
            buildTable();
          }
        };
        tdActions.appendChild(btnDelete);
      }

      tr.appendChild(tdActions);

      // Activation/d√©sactivation input affiliation selon badge s√©lectionn√©
      selectBadge.onchange = () => {
        if (selectBadge.value === "entreprise") {
          inputEntreprise.disabled = false;
          inputEntreprise.style.backgroundColor = "";
        } else {
          inputEntreprise.disabled = true;
          inputEntreprise.value = "";
          inputEntreprise.style.backgroundColor = "#eee";
        }
      };

      tbody.appendChild(tr);
    }
  }

  function logout() {
    localStorage.removeItem('instaUser');
  }

  buildTable();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Gestion utilisateurs avanc√©e avec badges emoji et images</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 10px;}
    table {width: 100%; border-collapse: collapse; margin-top: 15px;}
    th, td {border: 1px solid #aaa; padding: 8px; text-align: left;}
    th {background-color: #ddd;}
    input[type="text"], select {width: 100%; padding: 5px; box-sizing: border-box;}
    button {margin-top: 10px; padding: 8px 12px; cursor: pointer; background: #0095f6; color: white; border: none; border-radius: 4px; font-weight: bold;}
    nav a {margin-right: 10px; text-decoration: none; font-weight: bold; color: #333;}
    img.badge-icon {
      width: 20px;
      height: 20px;
      vertical-align: middle;
      margin-right: 6px;
    }
  </style>
</head>
<body>

<header>
  <h1>Admin - Gestion des utilisateurs avec badges</h1>
  <nav>
    <a href="feed.html">Feed</a>
    <a href="profil.html">Profil</a>
    <a href="index.html" onclick="logout()">D√©connexion</a>
  </nav>
</header>

<div id="message"></div>

<table id="usersTable">
  <thead>
    <tr>
      <th>Nom d'utilisateur</th>
      <th>Badge</th>
      <th>Entreprise affili√©e</th>
      <th>Bio</th>
      <th>Avatar URL</th>
      <th>Banni√®re URL</th>
      <th>Story</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <!-- Utilisateurs list√©s ici -->
  </tbody>
</table>

<script>
  // Exemple images de badges (remplace par tes images)
  const badgeImages = {
    "certifie": "https://cdn-icons-png.flaticon.com/512/190/190411.png", // ‚úîÔ∏è
    "entreprise": "https://cdn-icons-png.flaticon.com/512/189/189792.png", // üè¢
    "admin": "https://cdn-icons-png.flaticon.com/512/1077/1077012.png" // üõ°Ô∏è
  };

  // Badges avec emoji pour le select
  const badgesWithEmoji = {
    "": "(aucun)",
    "certifie": "‚úîÔ∏è Certifi√©",
    "entreprise": "üè¢ Entreprise",
    "admin": "üõ°Ô∏è Admin"
  };

  let users = JSON.parse(localStorage.getItem('instaUsers')) || {};
  let currentUser = JSON.parse(localStorage.getItem('instaUser'));

  function redirectToIndex() {
    alert("Acc√®s refus√© : page admin r√©serv√©e aux administrateurs.");
    window.location.href = "index.html";
  }

  // V√©rification que seul un admin peut acc√©der
  if (!currentUser || currentUser.badge !== "admin") {
    redirectToIndex();
  }

  function saveUsers() {
    localStorage.setItem('instaUsers', JSON.stringify(users));
  }

  function updateCurrentUserIfNeeded(username) {
    if (currentUser && currentUser.name === username) {
      currentUser = { name: username, ...users[username] };
      localStorage.setItem('instaUser', JSON.stringify(currentUser));
    }
  }

  function buildTable() {
    const tbody = document.querySelector('#usersTable tbody');
    tbody.innerHTML = '';

    for (const username in users) {
      const user = users[username];
      const tr = document.createElement('tr');

      // Nom
      const tdName = document.createElement('td');
      tdName.textContent = username;
      tr.appendChild(tdName);

      // Badge (affichage image + texte)
      const tdBadge = document.createElement('td');
      if(user.badge && badgeImages[user.badge]) {
        const img = document.createElement('img');
        img.src = badgeImages[user.badge];
        img.alt = user.badge;
        img.className = 'badge-icon';
        tdBadge.appendChild(img);
        tdBadge.appendChild(document.createTextNode(user.badge));
      } else {
        tdBadge.textContent = "(aucun)";
      }
      tr.appendChild(tdBadge);

      // Entreprise affili√©e
      const tdEntreprise = document.createElement('td');
      tdEntreprise.textContent = user.entrepriseAffiliee || "";
      tr.appendChild(tdEntreprise);

      // Bio
      const tdBio = document.createElement('td');
      tdBio.textContent = user.bio || "";
      tr.appendChild(tdBio);

      // Avatar URL
      const tdAvatar = document.createElement('td');
      tdAvatar.textContent = user.avatar || "";
      tr.appendChild(tdAvatar);

      // Banni√®re URL
      const tdBanner = document.createElement('td');
      tdBanner.textContent = user.banner || "";
      tr.appendChild(tdBanner);

      // Story
      const tdStory = document.createElement('td');
      tdStory.textContent = user.story || "";
      tr.appendChild(tdStory);

      // Actions avec modification badge & autres champs
      const tdActions = document.createElement('td');

      // Cr√©ation d‚Äôun select badge avec emojis
      const selectBadge = document.createElement('select');
      for(const key in badgesWithEmoji) {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = badgesWithEmoji[key];
        if(user.badge === key) option.selected = true;
        selectBadge.appendChild(option);
      }

      // Input affili√© (activ√© seulement si badge entreprise)
      const inputEntreprise = document.createElement('input');
      inputEntreprise.type = "text";
      inputEntreprise.placeholder = "Compte affili√©";
      inputEntreprise.value = user.entrepriseAffiliee || "";
      inputEntreprise.style.marginLeft = "10px";
      inputEntreprise.style.width = "120px";

      if(user.badge !== "entreprise") {
        inputEntreprise.disabled = true;
        inputEntreprise.style.backgroundColor = "#eee";
      }

      // Inputs pour bio, avatar, banner, story
      const inputBio = document.createElement('input');
      inputBio.type = "text";
      inputBio.placeholder = "Bio";
      inputBio.value = user.bio || "";
      inputBio.style.marginLeft = "10px";
      inputBio.style.width = "150px";

      const inputAvatar = document.createElement('input');
      inputAvatar.type = "text";
      inputAvatar.placeholder = "Avatar URL";
      inputAvatar.value = user.avatar || "";
      inputAvatar.style.marginLeft = "10px";
      inputAvatar.style.width = "150px";

      const inputBanner = document.createElement('input');
      inputBanner.type = "text";
      inputBanner.placeholder = "Banni√®re URL";
      inputBanner.value = user.banner || "";
      inputBanner.style.marginLeft = "10px";
      inputBanner.style.width = "150px";

      const inputStory = document.createElement('input');
      inputStory.type = "text";
      inputStory.placeholder = "Story";
      inputStory.value = user.story || "";
      inputStory.style.marginLeft = "10px";
      inputStory.style.width = "150px";

      // Bouton sauvegarder
      const btnSave = document.createElement('button');
      btnSave.textContent = "Sauvegarder";
      btnSave.style.marginLeft = "10px";

      btnSave.onclick = () => {
        const badgeSelected = selectBadge.value;
        users[username].badge = badgeSelected;
        users[username].bio = inputBio.value.trim();
        users[username].avatar = inputAvatar.value.trim() || "default-avatar.png";
        users[username].banner = inputBanner.value.trim();
        users[username].story = inputStory.value.trim();

        if(badgeSelected === "entreprise") {
          const affili√© = inputEntreprise.value.trim();
          if(affili√© && users[affili√©]) {
            users[username].entrepriseAffiliee = affili√©;
          } else {
            alert("Le compte affili√© n'existe pas. Laissez vide ou mettez un compte valide.");
            users[username].entrepriseAffiliee = "";
            inputEntreprise.value = "";
          }
        } else {
          users[username].entrepriseAffiliee = "";
          inputEntreprise.value = "";
        }

        saveUsers();
        updateCurrentUserIfNeeded(username);
        alert(`Utilisateur "${username}" mis √† jour !`);
        buildTable();
      };

      tdActions.appendChild(selectBadge);
      tdActions.appendChild(inputEntreprise);
      tdActions.appendChild(inputBio);
      tdActions.appendChild(inputAvatar);
      tdActions.appendChild(inputBanner);
      tdActions.appendChild(inputStory);
      tdActions.appendChild(btnSave);

      // Supprimer utilisateur sauf soi-m√™me
      if(currentUser.badge === "admin" && username !== currentUser.name) {
        const btnDelete = document.createElement('button');
        btnDelete.textContent = "Supprimer";
        btnDelete.style.marginLeft = "8px";
        btnDelete.onclick = () => {
          if(confirm(`Supprimer l'utilisateur "${username}" ?`)) {
            delete users[username];
            saveUsers();
            buildTable();
          }
        };
        tdActions.appendChild(btnDelete);
      }

      // Activation input affiliation si badge change
      selectBadge.onchange = () => {
        if(selectBadge.value === "entreprise") {
          inputEntreprise.disabled = false;
          inputEntreprise.style.backgroundColor = "";
        } else {
          inputEntreprise.disabled = true;
          inputEntreprise.value = "";
          inputEntreprise.style.backgroundColor = "#eee";
        }
      };

      tr.appendChild(tdActions);
      tbody.appendChild(tr);
    }
  }

  function logout
