<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel | InstaClone</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #333; color: white; }
    button { padding: 5px 10px; margin: 0 3px; }
    .badge {
      font-size: 18px;
      margin-right: 5px;
    }
    .logo {
      width: 30px;
      height: 30px;
      vertical-align: middle;
      border-radius: 3px;
      margin-right: 5px;
    }
  </style>
</head>
<body>

<h1>Panel Admin</h1>

<table id="usersTable">
  <thead>
    <tr>
      <th>Utilisateur</th>
      <th>Badges</th>
      <th>Affili√© √†</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="logout()">D√©connexion</button>

<script>
const entreprises = {
  'AcmeCorp': { name: "Acme Corporation", logo: "logos/acmecorp.png" },
  'TechInc': { name: "Tech Incorporated", logo: "logos/techinc.png" },
};

let users = JSON.parse(localStorage.getItem('instaUsers')) || [];

// On s‚Äôassure que l‚Äôadministrateur est connect√© (et a badge admin)
const currentUser = JSON.parse(localStorage.getItem('instaUser'));
if(!currentUser || !currentUser.badges || !currentUser.badges.includes('admin')){
  alert("Acc√®s refus√© : vous devez √™tre admin.");
  window.location.href = "index.html";
}

function renderUsers(){
  const tbody = document.querySelector('#usersTable tbody');
  tbody.innerHTML = '';
  users.forEach((user, i) => {
    const tr = document.createElement('tr');

    // Nom
    const tdName = document.createElement('td');
    tdName.textContent = user.name;
    tr.appendChild(tdName);

    // Badges
    const tdBadges = document.createElement('td');
    if(user.badges){
      user.badges.forEach(b => {
        const span = document.createElement('span');
        span.className = 'badge';
        if(b === 'admin') span.textContent = 'üõ°Ô∏è';
        else if(b === 'staff') span.textContent = '‚≠ê';
        else if(b === 'vip') span.textContent = 'üíé';
        else span.textContent = b;
        tdBadges.appendChild(span);
      });
    }
    tr.appendChild(tdBadges);

    // Affili√© √† (logo + nom)
    const tdAffiliate = document.createElement('td');
    if(user.affiliateWith && entreprises[user.affiliateWith]){
      const img = document.createElement('img');
      img.src = entreprises[user.affiliateWith].logo;
      img.alt = entreprises[user.affiliateWith].name;
      img.title = entreprises[user.affiliateWith].name;
      img.className = 'logo';
      tdAffiliate.appendChild(img);
      tdAffiliate.appendChild(document.createTextNode(entreprises[user.affiliateWith].name));
    } else {
      tdAffiliate.textContent = '‚Äî';
    }
    tr.appendChild(tdAffiliate);

    // Actions : Boutons d‚Äôajout/retrait affiliation
    const tdActions = document.createElement('td');

    // Liste d√©roulante pour choisir entreprise affiliation
    const select = document.createElement('select');
    const optionNone = document.createElement('option');
    optionNone.value = '';
    optionNone.textContent = 'Aucune';
    select.appendChild(optionNone);

    Object.keys(entreprises).forEach(pseudo => {
      const option = document.createElement('option');
      option.value = pseudo;
      option.textContent = entreprises[pseudo].name;
      if(user.affiliateWith === pseudo) option.selected = true;
      select.appendChild(option);
    });
    tdActions.appendChild(select);

    // Bouton sauvegarde
    const saveBtn = document.createElement('button');
    saveBtn.textContent = 'Sauvegarder';
    saveBtn.onclick = () => {
      user.affiliateWith = select.value || null;
      saveUsers();
      renderUsers();
      alert(`Affiliation mise √† jour pour ${user.name}`);
    };
    tdActions.appendChild(saveBtn);

    tr.appendChild(tdActions);

    tbody.appendChild(tr);
  });
}

function saveUsers(){
  localStorage.setItem('instaUsers', JSON.stringify(users));
}

// Chargement initial
renderUsers();

function logout(){
  localStorage.removeItem('instaUser');
  window.location.href = "index.html";
}
</script>

</body>
</html>
