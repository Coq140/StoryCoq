<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profil | InstaClone</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      display: flex;
      background: #f5f5f5;
    }
    .content {
      flex: 1;
      padding: 20px;
    }
    .sidebar {
      width: 200px;
      background: #eee;
      padding: 15px;
      border-left: 1px solid #ccc;
    }
    .sidebar a {
      display: block;
      margin: 10px 0;
      text-decoration: none;
      color: #333;
      font-weight: bold;
    }
    .sidebar a:hover {
      color: #0095f6;
    }
    .banner {
      background: #ddd;
      height: 150px;
      border-radius: 8px;
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 3px solid #fff;
      position: relative;
      top: -50px;
      background: #fff;
      object-fit: cover;
      cursor: pointer;
    }
    textarea {
      width: 100%;
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      margin-top: 10px;
      resize: vertical;
      min-height: 60px;
    }
    #storyDisplay img {
      max-width: 100%;
      margin-top: 5px;
      border-radius: 4px;
    }
    #profilBadge {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .badge {
      background: #eee;
      padding: 5px 10px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      cursor: default;
      position: relative;
      font-size: 16px;
    }
    .badge img {
      width: 20px;
      height: 20px;
      margin-right: 5px;
      border-radius: 3px;
    }
    .badge:hover .tooltip {
      display: block;
    }
    .tooltip {
      display: none;
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      pointer-events: none;
      z-index: 10;
    }
  </style>
</head>
<body>

<div class="content">
  <h1>Profil</h1>

  <div class="banner" id="banner" title="Clique pour changer la banni√®re" onclick="document.getElementById('bannerInput').click()">
    <input type="file" id="bannerInput" accept="image/*" style="display:none" onchange="updateBanner(event)">
    <span style="color:#666;">Cliquez ici pour changer la banni√®re</span>
  </div>

  <div class="profile-section">
    <img src="default-avatar.png" id="avatar" class="avatar" title="Clique pour changer l'avatar" onclick="document.getElementById('avatarInput').click()" alt="Avatar">
    <input type="file" id="avatarInput" accept="image/*" style="display:none" onchange="updateAvatar(event)">

    <h2 id="profilName"></h2>
    <div id="profilBadge"></div>

    <textarea id="bio" placeholder="Ajoute ta bio ici..." onchange="saveBio()"></textarea>

    <div class="story" style="margin-top:15px;">
      <label>Story : <input type="file" accept="image/*" onchange="addStory(event)"></label>
      <div id="storyDisplay"></div>
    </div>

    <div id="affiliateInfo" style="margin-top:20px; font-weight: bold;"></div>
  </div>
</div>

<div class="sidebar" id="sidebar"></div>

<script>
// Liste des entreprises avec logos (fichiers dans dossier /logos/)
const entreprises = {
  'AcmeCorp': { name: "Acme Corporation", logo: "logos/acmecorp.png" },
  'TechInc': { name: "Tech Incorporated", logo: "logos/techinc.png" },
  // ajoute ici d'autres entreprises
};

// Liste des badges (sans affili√©)
const badgesInfo = {
  admin: { display: 'üõ°Ô∏è', description: 'Administrateur du site' },
  staff: { display: '‚≠ê', description: 'Membre du staff' },
  vip: { display: 'üíé', description: 'Utilisateur VIP' }
};

let currentUser = JSON.parse(localStorage.getItem('instaUser'));

if (!currentUser) {
  alert("Vous devez √™tre connect√© !");
  window.location.href = "index.html";
}

// Affichage avatar et banni√®re
if(currentUser.avatar){
  document.getElementById('avatar').src = currentUser.avatar;
}
if(currentUser.banner){
  const banner = document.getElementById('banner');
  banner.style.backgroundImage = `url(${currentUser.banner})`;
  banner.style.backgroundSize = 'cover';
  banner.style.backgroundPosition = 'center';
  banner.innerHTML = '';
}

document.getElementById('profilName').innerText = currentUser.name;
document.getElementById('bio').value = currentUser.bio || '';

// Afficher stories
if(currentUser.stories && currentUser.stories.length > 0){
  const storyDisplay = document.getElementById('storyDisplay');
  currentUser.stories.forEach(story => {
    const img = document.createElement('img');
    img.src = story;
    storyDisplay.appendChild(img);
  });
}

// Fonction pour cr√©er un badge simple
function createBadgeElement(badgeKey){
  if(!badgesInfo[badgeKey]) return null;
  const badge = document.createElement('div');
  badge.className = 'badge';
  badge.textContent = badgesInfo[badgeKey].display;
  const tooltip = document.createElement('span');
  tooltip.className = 'tooltip';
  tooltip.textContent = badgesInfo[badgeKey].description;
  badge.appendChild(tooltip);
  return badge;
}

// Fonction badge affili√© avec logo
function createAffiliateBadge(affiliatePseudo){
  const entreprise = entreprises[affiliatePseudo];
  if(!entreprise) return null;
  const badge = document.createElement('div');
  badge.className = 'badge';
  badge.innerHTML = `<img src="${entreprise.logo}" alt="${entreprise.name}" title="Affili√© √† ${entreprise.name}">`;
  const tooltip = document.createElement('span');
  tooltip.className = 'tooltip';
  tooltip.textContent = `Affili√© √† ${entreprise.name}`;
  badge.appendChild(tooltip);
  badge.onclick = () => alert(`Compte affili√© √† l‚Äôentreprise : ${entreprise.name}`);
  return badge;
}

// Affichage badges dans profil
const badgeContainer = document.getElementById('profilBadge');
badgeContainer.innerHTML = '';

// Badges classiques
if(Array.isArray(currentUser.badges)){
  currentUser.badges.forEach(b => {
    const el = createBadgeElement(b);
    if(el) badgeContainer.appendChild(el);
  });
}

// Badge affili√©
if(currentUser.affiliateWith){
  const affBadge = createAffiliateBadge(currentUser.affiliateWith);
  if(affBadge) badgeContainer.appendChild(affBadge);
}

// Affichage texte affili√© en bas profil
const affiliateInfo = document.getElementById('affiliateInfo');
if(currentUser.affiliateWith && entreprises[currentUser.affiliateWith]){
  affiliateInfo.textContent = `Ce compte est affili√© √† l‚Äôentreprise : ${entreprises[currentUser.affiliateWith].name}`;
}else{
  affiliateInfo.textContent = '';
}

// Sauvegarde utilisateur dans localStorage
function saveUser(){
  localStorage.setItem('instaUser', JSON.stringify(currentUser));
}

// Mise √† jour avatar
function updateAvatar(event){
  const file = event.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById('avatar').src = e.target.result;
      currentUser.avatar = e.target.result;
      saveUser();
    };
    reader.readAsDataURL(file);
  }
}

// Mise √† jour banni√®re
function updateBanner(event){
  const file = event.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => {
      const banner = document.getElementById('banner');
      banner.style.backgroundImage = `url(${e.target.result})`;
      banner.style.backgroundSize = 'cover';
      banner.style.backgroundPosition = 'center';
      banner.innerHTML = '';
      currentUser.banner = e.target.result;
      saveUser();
    };
    reader.readAsDataURL(file);
  }
}

// Sauvegarde bio
function saveBio(){
  currentUser.bio = document.getElementById('bio').value;
  saveUser();
}

// Ajouter story
function addStory(event){
  const file = event.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => {
      const img = document.createElement('img');
      img.src = e.target.result;
      document.getElementById('storyDisplay').appendChild(img);
      if(!currentUser.stories) currentUser.stories = [];
      currentUser.stories.push(e.target.result);
      saveUser();
    };
    reader.readAsDataURL(file);
  }
}

// Menu lat√©ral
const sidebar = document.getElementById('sidebar');
sidebar.innerHTML = `
  <a href="feed.html">üè† Feed</a>
  <a href="explore.html">üîç Explore</a>
  <a href="profil.html">üë§ Profil</a>
  ${currentUser.badges && currentUser.badges.includes('admin') ? '<a href="admin.html">‚öôÔ∏è Admin</a>' : ''}
  <a href="#" onclick="logout()">üö™ D√©connexion</a>
`;

function logout(){
  localStorage.removeItem('instaUser');
  window.location.href = "index.html";
}
</script>

</body>
</html>
